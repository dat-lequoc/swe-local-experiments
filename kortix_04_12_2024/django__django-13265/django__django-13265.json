{
  "instance_id": "django__django-13265",
  "model_patch": "diff --git a/django/db/migrations/operations/models.py b/django/db/migrations/operations/models.py\nindex dddf7c679c..5d103e735f 100644\n--- a/django/db/migrations/operations/models.py\n+++ b/django/db/migrations/operations/models.py\n@@ -783,6 +783,16 @@ class AddIndex(IndexOperation):\n     def migration_name_fragment(self):\n         return '%s_%s' % (self.model_name_lower, self.index.name.lower())\n \n+    def reduce(self, operation, app_label):\n+        if (isinstance(operation, AlterOrderWithRespectTo) and\n+            self.model_name_lower == operation.name_lower and\n+            '_order' in [field.lower() for field in self.index.fields]):\n+            return [\n+                operation,\n+                self,\n+            ]\n+        return super().reduce(operation, app_label)\n+\n \n class RemoveIndex(IndexOperation):\n     \"\"\"Remove an index from a model.\"\"\"\n@@ -904,4 +914,4 @@ class RemoveConstraint(IndexOperation):\n \n     @property\n     def migration_name_fragment(self):\n-        return 'remove_%s_%s' % (self.model_name_lower, self.name.lower())\n+        return 'remove_%s_%s' % (self.model_name_lower, self.name.lower())\n\\ No newline at end of file\ndiff --git a/tests/migrations/test_optimizer.py b/tests/migrations/test_optimizer.py\nindex 2950635514..3614076eac 100644\n--- a/tests/migrations/test_optimizer.py\n+++ b/tests/migrations/test_optimizer.py\n@@ -308,6 +308,33 @@ class OptimizerTests(SimpleTestCase):\n             app_label='test_app',\n         )\n \n+    def test_alter_order_with_respect_to_add_index(self):\n+        \"\"\"\n+        AddIndex with _order field should run after AlterOrderWithRespectTo.\n+        \"\"\"\n+        self.assertOptimizesTo(\n+            [\n+                migrations.AddIndex(\n+                    model_name='Foo',\n+                    index=models.Index(fields=['look', '_order'], name='look_foo_look_id_idx'),\n+                ),\n+                migrations.AlterOrderWithRespectTo(\n+                    name='Foo',\n+                    order_with_respect_to='look',\n+                ),\n+            ],\n+            [\n+                migrations.AlterOrderWithRespectTo(\n+                    name='Foo',\n+                    order_with_respect_to='look',\n+                ),\n+                migrations.AddIndex(\n+                    model_name='Foo',\n+                    index=models.Index(fields=['look', '_order'], name='look_foo_look_id_idx'),\n+                ),\n+            ],\n+        )\n+\n     def test_create_model_add_field(self):\n         \"\"\"\n         AddField should optimize into CreateModel.\n@@ -829,4 +856,4 @@ class OptimizerTests(SimpleTestCase):\n             [\n                 migrations.CreateModel(\"Phou\", [(\"name\", models.CharField(max_length=255))]),\n             ],\n-        )\n+        )\n\\ No newline at end of file\n",
  "model_name_or_path": "KortixAI"
}