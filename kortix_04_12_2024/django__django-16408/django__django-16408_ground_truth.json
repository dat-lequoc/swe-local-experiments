{
  "patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -1274,6 +1274,9 @@ def local_setter(final_field, obj, from_obj):\n                 if from_obj:\n                     final_field.remote_field.set_cached_value(from_obj, obj)\n \n+            def local_setter_noop(obj, from_obj):\n+                pass\n+\n             def remote_setter(name, obj, from_obj):\n                 setattr(from_obj, name, obj)\n \n@@ -1295,7 +1298,11 @@ def remote_setter(name, obj, from_obj):\n                         \"model\": model,\n                         \"field\": final_field,\n                         \"reverse\": True,\n-                        \"local_setter\": partial(local_setter, final_field),\n+                        \"local_setter\": (\n+                            partial(local_setter, final_field)\n+                            if len(joins) <= 2\n+                            else local_setter_noop\n+                        ),\n                         \"remote_setter\": partial(remote_setter, name),\n                         \"from_parent\": from_parent,\n                     }\n",
  "test_patch": "diff --git a/tests/known_related_objects/tests.py b/tests/known_related_objects/tests.py\n--- a/tests/known_related_objects/tests.py\n+++ b/tests/known_related_objects/tests.py\n@@ -164,3 +164,23 @@ def test_reverse_fk_select_related_multiple(self):\n             )\n             self.assertIs(ps[0], ps[0].pool_1.poolstyle)\n             self.assertIs(ps[0], ps[0].pool_2.another_style)\n+\n+    def test_multilevel_reverse_fk_cyclic_select_related(self):\n+        with self.assertNumQueries(3):\n+            p = list(\n+                PoolStyle.objects.annotate(\n+                    tournament_pool=FilteredRelation(\"pool__tournament__pool\"),\n+                ).select_related(\"tournament_pool\", \"tournament_pool__tournament\")\n+            )\n+            self.assertEqual(p[0].tournament_pool.tournament, p[0].pool.tournament)\n+\n+    def test_multilevel_reverse_fk_select_related(self):\n+        with self.assertNumQueries(2):\n+            p = list(\n+                Tournament.objects.filter(id=self.t2.id)\n+                .annotate(\n+                    style=FilteredRelation(\"pool__another_style\"),\n+                )\n+                .select_related(\"style\")\n+            )\n+            self.assertEqual(p[0].style.another_pool, self.p3)\n"
}