{
  "instance_id": "matplotlib__matplotlib-23476",
  "model_patch": "diff --git a/lib/matplotlib/backends/backend_macosx.py b/lib/matplotlib/backends/backend_macosx.py\nindex 700d1d4c58..df1f00c728 100644\n--- a/lib/matplotlib/backends/backend_macosx.py\n+++ b/lib/matplotlib/backends/backend_macosx.py\n@@ -101,6 +101,13 @@ class FigureCanvasMac(FigureCanvasAgg, _macosx.FigureCanvas, FigureCanvasBase):\n         ResizeEvent(\"resize_event\", self)._process()\n         self.draw_idle()\n \n+    def _set_device_pixel_ratio(self, ratio):\n+        \"\"\"Set the device pixel ratio and update figure DPI accordingly.\"\"\"\n+        super()._set_device_pixel_ratio(ratio)\n+        # Only update DPI if it hasn't been explicitly preserved\n+        if not hasattr(self.figure, '_stored_dpi'):\n+            self.figure._dpi = self.figure._dpi\n+\n \n class NavigationToolbar2Mac(_macosx.NavigationToolbar2, NavigationToolbar2):\n \n@@ -179,4 +186,4 @@ class _BackendMac(_Backend):\n \n     @staticmethod\n     def mainloop():\n-        _macosx.show()\n+        _macosx.show()\n\\ No newline at end of file\ndiff --git a/lib/matplotlib/tests/test_pickle.py b/lib/matplotlib/tests/test_pickle.py\nindex 0d0a5e5977..12f2b77e85 100644\n--- a/lib/matplotlib/tests/test_pickle.py\n+++ b/lib/matplotlib/tests/test_pickle.py\n@@ -237,3 +237,13 @@ def test_dynamic_norm():\n def test_vertexselector():\n     line, = plt.plot([0, 1], picker=True)\n     pickle.loads(pickle.dumps(VertexSelector(line)))\n+\n+def test_figure_dpi_preservation():\n+    \"\"\"Test that figure DPI is preserved after pickling/unpickling.\"\"\"\n+    fig = plt.figure(dpi=200)\n+    # Store original DPI\n+    original_dpi = fig.dpi\n+    # Pickle and unpickle multiple times\n+    for _ in range(3):\n+        fig = pickle.loads(pickle.dumps(fig))\n+        assert fig.dpi == original_dpi, \"DPI changed after pickle/unpickle cycle\"\n\\ No newline at end of file\n",
  "model_name_or_path": "KortixAI"
}