{
  "patch": "diff --git a/src/_pytest/nodes.py b/src/_pytest/nodes.py\n--- a/src/_pytest/nodes.py\n+++ b/src/_pytest/nodes.py\n@@ -29,6 +29,7 @@\n from _pytest.mark.structures import MarkDecorator\n from _pytest.mark.structures import NodeKeywords\n from _pytest.outcomes import fail\n+from _pytest.pathlib import Path\n from _pytest.store import Store\n \n if TYPE_CHECKING:\n@@ -361,9 +362,14 @@ def _repr_failure_py(\n         else:\n             truncate_locals = True\n \n+        # excinfo.getrepr() formats paths relative to the CWD if `abspath` is False.\n+        # It is possible for a fixture/test to change the CWD while this code runs, which\n+        # would then result in the user seeing confusing paths in the failure message.\n+        # To fix this, if the CWD changed, always display the full absolute path.\n+        # It will be better to just always display paths relative to invocation_dir, but\n+        # this requires a lot of plumbing (#6428).\n         try:\n-            os.getcwd()\n-            abspath = False\n+            abspath = Path(os.getcwd()) != Path(self.config.invocation_dir)\n         except OSError:\n             abspath = True\n \n",
  "test_patch": "diff --git a/testing/test_nodes.py b/testing/test_nodes.py\n--- a/testing/test_nodes.py\n+++ b/testing/test_nodes.py\n@@ -58,3 +58,30 @@ class FakeSession:\n \n     outside = py.path.local(\"/outside\")\n     assert nodes._check_initialpaths_for_relpath(FakeSession, outside) is None\n+\n+\n+def test_failure_with_changed_cwd(testdir):\n+    \"\"\"\n+    Test failure lines should use absolute paths if cwd has changed since\n+    invocation, so the path is correct (#6428).\n+    \"\"\"\n+    p = testdir.makepyfile(\n+        \"\"\"\n+        import os\n+        import pytest\n+\n+        @pytest.fixture\n+        def private_dir():\n+            out_dir = 'ddd'\n+            os.mkdir(out_dir)\n+            old_dir = os.getcwd()\n+            os.chdir(out_dir)\n+            yield out_dir\n+            os.chdir(old_dir)\n+\n+        def test_show_wrong_path(private_dir):\n+            assert False\n+    \"\"\"\n+    )\n+    result = testdir.runpytest()\n+    result.stdout.fnmatch_lines([str(p) + \":*: AssertionError\", \"*1 failed in *\"])\n"
}